<!DOCTYPE html>
<html>
<head>
<title>NOVAK Continuous Hashing Loop Demo</title>
<style>
  body { 
    background: #101015; 
    font-family: 'Consolas', monospace;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
  }

  .canvas {
    background: #181820;
    border: 1px solid #303038;
    width: 800px;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h2 { 
    text-align: center; 
    text-transform: uppercase; 
    letter-spacing: 3px; 
    font-size: 1.8rem; 
    margin: 0 0 10px 0; 
    color: #00ff73; /* Neon Green */
  }
  .sub-title { 
    text-align: center; 
    color: #777; 
    font-size: 0.9rem; 
    margin-bottom: 20px; 
    text-transform: uppercase; 
    letter-spacing: 1px; 
  }

  #output {
    background: #000;
    padding: 20px;
    border-radius: 8px;
    width: 90%;
    color: #00ff73;
    font-size: 0.9rem;
    line-height: 1.8;
    box-shadow: inset 0 0 10px rgba(0, 255, 115, 0.2);
    min-height: 250px;
    text-align: left;
  }

  .controls {
    margin-top: 20px;
    display: flex;
    gap: 15px;
    align-items: center;
  }
  
  .controls label {
    font-size: 0.9rem;
    color: #ccc;
  }
  
  .controls input[type="text"] {
    padding: 8px;
    border: 1px solid #303038;
    background: #252530;
    color: #fff;
    border-radius: 4px;
    width: 200px;
    font-family: monospace;
  }

  button {
    padding: 10px 20px;
    background: #00ff73;
    color: #101015;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: #00e667;
  }
  
  .instruction {
    margin-top: 20px;
    font-size: 0.8rem;
    color: #aaa;
  }
  
  .highlight {
      color: #ffd700;
  }
  
  .changed-rule {
      color: #ff6347; /* Red/Orange for change warning */
      font-weight: bold;
  }
</style>
</head>
<body>

<div class="canvas">
  <h2>NOVAK Continuous Hashing Loop</h2>
  <div class="sub-title">HARMONEE Receipt & REVELATION Chain Demonstration</div>

  <pre id="output">Initializing...</pre>
  
  <div class="controls">
    <label for="ruleInput">Current NOVAK Rule:</label>
    <input type="text" id="ruleInput" value="RULE_ID=VA_2025.CLAIM_CHECK">
    <button onclick="changeRule()">Force Rule Change</button>
  </div>
  
  <div class="instruction">
    Click <span class="highlight">Force Rule Change</span> and observe how the <span class="highlight">REVELATION</span> hash instantly and permanently changes in the next transaction.
  </div>

</div>

<script>
// Simple SHA-256 function using WebCrypto API
async function sha256(str) {
  const encoder = new TextEncoder();
  const data = encoder.encode(str);
  const hashBuffer = await crypto.subtle.digest("SHA-256", data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2,"0")).join("");
}

// NOVAK loop variables
let prevChain = "GENESIS_BLOCK_00000000000000000000000000000000"; // Start chain from a fixed genesis hash
let intervalId = null;
let transactionCount = 0;
let ruleChanged = false;

async function loop() {
  const timestamp = new Date().toISOString();
  // NIPS Data (Input + Output) - We'll simulate changing input by incrementing a counter
  const input = `INPUT=Verified_Test_Data_${transactionCount}`;
  const output = `OUTPUT=Approved`;
  
  const currentRule = document.getElementById("ruleInput").value;
  let ruleDisplay = currentRule;
  
  if (ruleChanged) {
      ruleDisplay = `<span class="changed-rule">${currentRule} (RULE MODIFIED!)</span>`;
      ruleChanged = false; // Reset warning after one cycle
  }

  // 1. HARMONEE receipt (rule + input + output + timestamp)
  const harmonee_receipt = await sha256(currentRule + input + output + timestamp);

  // 2. REVELATION global chain (Previous REVELATION + HARMONEE)
  const revelation_chain = await sha256(prevChain + harmonee_receipt);

  // Update history and transaction count
  const oldPrevChain = prevChain;
  prevChain = revelation_chain;
  transactionCount++;
  
  // Display current transaction (REPLACING content)
  const outputEl = document.getElementById("output");
  outputEl.innerHTML = `--- CURRENT TRANSACTION ${transactionCount} ---\n` 
    + `[NOVAK Rule]: ${ruleDisplay}\n`
    + `[NIPS Data]: ${input} & ${output}\n`
    + `[Timestamp]: ${timestamp}\n\n`
    + `[PREVIOUS REVELATION]: ${oldPrevChain.substring(0, 40)}...\n`
    + `\t\t\t\t<-- Linked to the last block\n`
    + `[HARMONEE Receipt]: ${harmonee_receipt.substring(0, 40)}...\n`
    + `\t\t\t\t<-- Proof of execution\n`
    + `[NEW REVELATION]: ${revelation_chain.substring(0, 40)}...\n`;
}

function startLoop() {
    if (intervalId) clearInterval(intervalId);
    intervalId = setInterval(loop, 1000); // 1 second interval for faster replacement
}

function changeRule() {
    // Modify the displayed rule value slightly to simulate tampering
    const inputEl = document.getElementById("ruleInput");
    inputEl.value = inputEl.value.includes('MODIFIED') 
        ? "RULE_ID=VA_2025.CLAIM_CHECK" 
        : "RULE_ID=VA_2025.CLAIM_CHECK_MODIFIED_1";
    
    ruleChanged = true;
    
    // The loop() function will automatically pick up the new value in the next cycle,
    // demonstrating that any change to the NOVAK rule instantly changes HARMONEE and REVELATION.
}

document.addEventListener('DOMContentLoaded', startLoop);
</script>

</body>
</html>
